const MM_INSTANCE_URL = process.env.MM_INSTANCE_URL;
const MM_AUTH_TOKEN = process.env.MM_AUTH_TOKEN;
const MM_USER_ID = process.env.MM_USER_ID;
const MM_CHANNEL_ID = process.env.MM_CHANNEL_ID; // the ID of the channel where we create the post

const MM_TARGET_ID = "xbnwfda917r3fm7ki87frgfwrw"; // ID of a post, which the embed will target
const MM_SHOWN_USER_ID = "wsidftam6i88zxugtq7qxxez4h"; // the user shown in the embed, in this example its the userid of system

const metadata = {
  embeds: [
    {
      type: "permalink",
      data: {
        post_id: MM_TARGET_ID,
        post: {
          id: MM_TARGET_ID,
          user_id: MM_SHOWN_USER_ID,
          channel_id: "doesnt-matter",
          root_id: "",
          original_id: "",
          message: [5],
          type: "",
          props: {},
          hashtags: "",
          reply_count: 0,
          last_reply_at: 0,
          participants: [],
          metadata: {},
        },
        team_name: "",
        channel_display_name: "can-be-anything-i-want",
        channel_type: "O",
        channel_id: "",
      },
    },
  ],
};

const body = JSON.stringify({
  file_ids: [],
  message: "",
  props: {
    previewed_post: MM_TARGET_ID,
  },
  channel_id: MM_CHANNEL_ID,
  user_id: MM_USER_ID,
  metadata,
});

console.log(JSON.stringify(metadata));
console.log(JSON.stringify(body));

const resp = await fetch(`${MM_INSTANCE_URL}/api/v4/posts`, {
  headers: {
    "Content-Type": "application/json",
    Authorization: `Bearer ${MM_AUTH_TOKEN}`,
  },
  method: "POST",
  body,
});

console.log(JSON.stringify(await resp.json(), null, 4));
