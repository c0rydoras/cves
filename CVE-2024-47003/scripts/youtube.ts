const MM_INSTANCE_URL = process.env.MM_INSTANCE_URL;
const MM_AUTH_TOKEN = process.env.MM_AUTH_TOKEN;
const MM_USER_ID = process.env.MM_USER_ID;
const MM_CHANNEL_ID = process.env.MM_CHANNEL_ID; // the ID of the channel where we create the post

const TARGET_URL = "https://github.com/c0rydoras";

const metadata = {
  embeds: [
    {
      type: "opengraph",
      url: `${TARGET_URL}?ignore=https://youtube.com/watch?v=dQw4w9WgXcQ`,
      data: {
        type: "video.other",
        url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
        title: "Customizable",
        description: "This is a description",
        determiner: "",
        site_name: "YouTube",
        locale: "",
        locales_alternate: null,
        images: [
          {
            url: "https://i.ytimg.com/vi/dQw4w9WgXcQ/maxresdefault.jpg",
            secure_url: "",
            type: "",
            width: 1280,
            height: 720,
          },
        ],
        audios: null,
        videos: null,
      },
    },
  ],
  images: {
    "https://i.ytimg.com/vi/dQw4w9WgXcQ/maxresdefault.jpg": {
      width: 1280,
      height: 720,
      format: "jpeg",
      frame_count: 0,
    },
  },
};

const body = JSON.stringify({
  file_ids: [],
  message: "",
  channel_id: MM_CHANNEL_ID,
  user_id: MM_USER_ID,
  metadata,
});

const resp = await fetch(`${MM_INSTANCE_URL}/api/v4/posts`, {
  headers: {
    "Content-Type": "application/json",
    Authorization: `Bearer ${MM_AUTH_TOKEN}`,
  },
  method: "POST",
  body,
});

console.log(JSON.stringify(await resp.json(), null, 4));
