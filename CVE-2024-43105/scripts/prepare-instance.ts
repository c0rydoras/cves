#!/usr/bin/env bun

const CHANNEL_ID = process.env.MM_CHANNEL_ID;
const MM_AUTH_TOKEN = process.env.MM_AUTH_TOKEN ?? process.env.MM_ADMIN_TOKEN;
const MM_USER_ID = process.env.MM_USER_ID;

const body = () =>
  JSON.stringify({
    message: Array(450)
      .fill(1)
      .map(() => crypto.randomUUID())
      .join(""),
    channel_id: CHANNEL_ID,
    user_id: MM_USER_ID,
  });

const URL = process.env.MM_INSTANCE_URL ?? "http://localhost:8065";

const headers = {
  Authorization: `Bearer ${MM_AUTH_TOKEN}`,
};

const spam = () => {
  const resp = fetch(`${URL}/api/v4/posts`, {
    body: body(),
    method: "POST",
    headers,
  });
  return resp;
};

console.log(await(await spam()).json());
await Promise.all(
  Array(3000)
    .fill(1)
    .map(async (_) => await spam()),
);
