#!/usr/bin/env bun

const CHANNEL_ID = process.env.MM_CHANNEL_ID;
const MM_AUTH_TOKEN = process.env.MM_AUTH_TOKEN ?? process.env.MM_ADMIN_TOKEN;
const MM_TEAM_ID = process.env.MM_TEAM_ID;

const URL = process.env.MM_INSTANCE_URL ?? "http://localhost:8065";

const headers = {
  Authorization: `Bearer ${MM_AUTH_TOKEN}`,
};

const doExport = () => {
  return fetch(`${URL}/api/v4/commands/execute`, {
    body: JSON.stringify({
      command: "/export ",
      channel_id: CHANNEL_ID,
      team_id: MM_TEAM_ID,
    }),
    method: "POST",
    headers,
  });
};

const results = await Promise.all(
  Array(50)
    .fill(1)
    .map(async (_) => await doExport()),
);
console.log(results);
